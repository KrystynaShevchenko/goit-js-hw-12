{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["// axios\nimport axios from 'axios';\n\n// iziToast\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\n// SimpleLightbox\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst refs = {\n  form: document.querySelector('.form'),\n  gallery: document.querySelector('.gallery-list'),\n  loader: document.querySelector('span'),\n  loadMoreBtn: document.querySelector('[data-action=\"load-more\"]'),\n};\n\nlet page = 1;\nlet totalPage = 0;\nlet searchQuery = '';\nlet y = 0;\nconst perPage = 40;\n\nconst instance = axios.create({\n  headers: { 'Content-Type': 'application/json' },\n  params: {\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  },\n});\n\nrefs.form.addEventListener('submit', onFormSubmit);\nrefs.loadMoreBtn.addEventListener('click', onLoadMoreBtnClick);\n\nasync function onFormSubmit(event) {\n  event.preventDefault();\n  page = 1;\n  refs.gallery.innerHTML = '';\n  showLoader();\n  hiddenLoadMoreBtn();\n  const form = event.currentTarget;\n  searchQuery = form.elements.search.value;\n\n  try {\n    const data = await fetchImg(searchQuery);\n\n    if (!data.total) {\n      const error =\n        'Sorry, there are no images matching your search query. Please try again!';\n      onFetchError(error);\n    } else {\n      renderGallery(data);\n      showLoadMoreBtn();\n      page += 1;\n      totalPage = data.totalHits / perPage;\n    }\n  } catch (e) {\n    onFetchError(e.message);\n  } finally {\n    hiddenLoader();\n  }\n\n  refs.form.reset();\n}\n\nasync function fetchImg(tags) {\n  const params = new URLSearchParams({\n    per_page: perPage,\n    page: page,\n  });\n\n  try {\n    const response = await instance.get(\n      `https://pixabay.com/api/?key=41464538-044fa7fe64ee4a60fb4972757&q=${tags}&${params}`\n    );\n    // console.log(response.data);\n    return response.data;\n  } catch (e) {\n    onFetchError(e.message);\n  }\n}\n\nfunction renderGallery(data) {\n  const imagesData = data.hits;\n  const images = imagesData.map(image => {\n    return {\n      preview: image.webformatURL,\n      original: image.largeImageURL,\n      description: image.tags,\n      views: image.views,\n      comments: image.comments,\n      downloads: image.downloads,\n      likes: image.likes,\n    };\n  });\n\n  const galleryString = images.reduce(\n    (\n      html,\n      { preview, original, description, views, comments, downloads, likes }\n    ) => {\n      return (\n        html +\n        `<li class=\"gallery\">\n          <a class=\"gallery-link\" href=${original} >       \n           <img\n            class=\"gallery-image\"\n            src=${preview}\n            alt=\"${description}\"\n            />          <ul class=\"desc\">\n            <li class=\"desc-item\">\n              <h2 class=\"desc-title\">likes</h2>\n              <p class=\"desc-text\">${likes}</p>\n            </li>\n            <li class=\"desc-item\">\n              <h2 class=\"desc-title\">views</h2>\n              <p class=\"desc-text\">${views}</p>\n            </li>\n            <li class=\"desc-item\">\n              <h2 class=\"desc-title\">comments</h2>\n              <p class=\"desc-text\">${comments}</p>\n            </li>\n            <li class=\"desc-item\">\n              <h2 class=\"desc-title\">downloads</h2>\n              <p class=\"desc-text\">${downloads}</p>\n            </li>\n          </ul></a>\n        </li>`\n      );\n    },\n    ''\n  );\n\n  refs.gallery.insertAdjacentHTML('beforeend', galleryString);\n\n  const galleryItem = document.querySelector('.gallery');\n  const rect = galleryItem.getBoundingClientRect();\n  y = rect.height * 2;\n  // console.log(rect.height);\n\n  const lightbox = new SimpleLightbox('.gallery a', {\n    captionsData: 'alt',\n    captionDelay: 250,\n  });\n  lightbox.refresh();\n}\n\nfunction onFetchError(errorMessage = 'Something went wrong!') {\n  iziToast.error({\n    position: 'topRight',\n    message: errorMessage,\n  });\n}\n\nasync function onLoadMoreBtnClick(event) {\n  hiddenLoadMoreBtn();\n  showLoader();\n\n  if (page > totalPage) {\n    hiddenLoader();\n    return iziToast.show({\n      position: 'topRight',\n      message: \"We're sorry, but you've reached the end of search results.\",\n    });\n  }\n\n  try {\n    const data = await fetchImg(searchQuery);\n    renderGallery(data);\n    windowScroll(y);\n    showLoadMoreBtn();\n    page += 1;\n  } catch (e) {\n    onFetchError(e.message);\n  } finally {\n    hiddenLoader();\n  }\n}\n\nfunction showLoader() {\n  refs.loader.hidden = false;\n  refs.loader.classList.add('loader');\n}\n\nfunction hiddenLoader() {\n  refs.loader.hidden = true;\n  refs.loader.classList.remove('loader');\n}\n\nfunction showLoadMoreBtn() {\n  refs.loadMoreBtn.classList.remove('is-hidden');\n}\n\nfunction hiddenLoadMoreBtn() {\n  refs.loadMoreBtn.classList.add('is-hidden');\n}\n\nfunction windowScroll(y) {\n  window.scrollBy({\n    top: y,\n    behavior: 'smooth',\n  });\n}\n"],"names":["refs","page","totalPage","searchQuery","y","perPage","instance","axios","onFormSubmit","onLoadMoreBtnClick","event","showLoader","hiddenLoadMoreBtn","data","fetchImg","renderGallery","showLoadMoreBtn","onFetchError","e","hiddenLoader","tags","params","galleryString","image","html","preview","original","description","views","comments","downloads","likes","SimpleLightbox","errorMessage","iziToast","windowScroll"],"mappings":"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"}